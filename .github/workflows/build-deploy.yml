name: build-deploy

on:
  push:
    branches: [ feature/cideploy ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Set up Go 1.x
      uses: actions/setup-go@v2
      with:
        go-version: ^1.16

    - name: Check out code into the Go module directory
      uses: actions/checkout@v2
        
#     - name: Build
#       run: go build -v cmd/gokub-tester/main.go
      
#     - name: Set up QEMU
#       uses: docker/setup-qemu-action@v1
    
#     - name: Login to DockerHub
#       uses: docker/login-action@v1 
#       with:
#         username: ${{ secrets.DOCKER_USERNAME }}
#         password: ${{ secrets.DOCKER_PASSWORD }}
    
#     - name: Push to Docker Hub
#       uses: docker/build-push-action@v2
#       with:
#         platforms: linux/arm64
#         context: .
#         file: ./Dockerfile
#         push: true 
#         tags: horvatic/gokub-tester:latest
        
    - name: Kubectl tool installer
      uses: Azure/setup-kubectl@v1
  
    - name: Decode Config
      run: echo ${{ secrets.K8S_CONFIG }} | base64 --decode 
  
    - name: Setup kubectl
    - run: |
        cd $HOME
        mkdir .kube
        cd .kube
        echo ${{ secrets.K8S_CONFIG }} | base64 --decode > config
      
    - name: Get pods
      run: kubectl get pod -n dev
